# Makefile for programming the ATtiny85
# modified the one generated by CrossPack

DEVICE      = attiny85
CLOCK      = 8000000
PROGRAMMER = -c usbtiny 
# for ATTiny85
# see http://www.engbedded.com/fusecalc/
FUSES       = -U lfuse:w:0xE2:m -U hfuse:w:0xdf:m -U efuse:w:0xff:m 

# Tune the lines below only if you know what you are doing:
AVRDUDE = avrdude $(PROGRAMMER) -p $(DEVICE)
COMPILE = avr-gcc -Wall -Os -DF_CPU=$(CLOCK) -mmcu=$(DEVICE)

ifndef ID
$(error ID is not set. Please use ID=<number> on command line)
endif

ifdef QUICK
SLEEP_TIME = 6
SLEEP_REPEAT = 1
MAX_SAME = 1
else
SLEEP_TIME = 9
SLEEP_REPEAT = 4
MAX_SAME = 20
endif

ifdef RADION
ENABLE_RADIOEN = 1
else
ENABLE_RADIOEN = 0
endif

ifdef STEADY
ENABLE_STEADY = 1
else
ENABLE_STEADY = 0
endif

flash:
	python patchid.py $(ID) $(SLEEP_TIME) $(SLEEP_REPEAT) $(MAX_SAME) $(ENABLE_RADIOEN) $(ENABLE_STEADY)
	$(AVRDUDE) -B 3 -c usbasp -U flash:w:baromdisp-85.ino.withid.hex:i

fuse:
	$(AVRDUDE) -B 3 -c usbasp $(FUSES)
